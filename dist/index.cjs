"use strict";var Z=Object.create;var y=Object.defineProperty;var ee=Object.getOwnPropertyDescriptor;var te=Object.getOwnPropertyNames;var ne=Object.getPrototypeOf,re=Object.prototype.hasOwnProperty;var oe=(n,e)=>{for(var t in e)y(n,t,{get:e[t],enumerable:!0})},Q=(n,e,t,r)=>{if(e&&typeof e=="object"||typeof e=="function")for(let o of te(e))!re.call(n,o)&&o!==t&&y(n,o,{get:()=>e[o],enumerable:!(r=ee(e,o))||r.enumerable});return n};var f=(n,e,t)=>(t=n!=null?Z(ne(n)):{},Q(e||!n||!n.__esModule?y(t,"default",{value:n,enumerable:!0}):t,n)),se=n=>Q(y({},"__esModule",{value:!0}),n);var ce={};oe(ce,{TSRouter:()=>P,html:()=>x,useAnchor:()=>q,useAnchorSingle:()=>k,useInitialDOM:()=>O,useTSAuth:()=>I,useTSComponent:()=>L,useTSElementEach:()=>F,useTSElements:()=>D,useTSEvent:()=>w,useTSEventAll:()=>b,useTSExtractParams:()=>H,useTSMetaData:()=>$,useTSParams:()=>T,useTSPurifier:()=>A,useTSSelect:()=>N});module.exports=se(ce);function x(n,...e){return n.reduce((t,r,o)=>t+r+(e[o]||""),"")}var R=f(require("dompurify"),1),A=(n,e)=>{let r={...{ADD_TAGS:["my-custom-tag"]},...e};return typeof n=="string"?R.default.sanitize(n,r):R.default.sanitize(n.innerHTML,r)};var w=(n,e,t)=>{let r=document.querySelector(`#${n}`);r?r.addEventListener(e,t):console.warn(`Element with id '${n}' not found.`)};var _=require("zustand/vanilla"),C=f(require("dompurify"),1);function ie(n,e){let t=[],r=n.replace(/:[^/]+/g,i=>(t.push(i.slice(1)),"([^/]+)")),o=new RegExp(`^${r}$`),s=e.match(o),a={};return s&&t.forEach((i,l)=>{a[i]=C.default.sanitize(s[l+1]??"")}),a}function ae(n){let e={},t=new URLSearchParams(n);for(let[r,o]of t.entries())e[r]=C.default.sanitize(o);return e}var T=(0,_.createStore)((n,e)=>({params:{},query:{},setFromPattern:t=>{let r=window.location.pathname,o=ie(t,r),s=ae(window.location.search);n({params:o,query:s})},getParam:t=>e().params[t],getQuery:t=>e().query[t]}));function H(n){let e=T.getState();e.setFromPattern(n);let t=e.params,r=e.query;return{...t,...r}}var b=(n,e,t)=>{let r=document.querySelectorAll(n);return r.forEach(o=>{o.addEventListener(e,t)}),()=>{r.forEach(o=>{o.removeEventListener(e,t)})}};var j=f(require("dompurify"),1),D=(n,e,t)=>{let r={ALLOWED_TAGS:["main","div","h1","p","button","span","a","img","input"],ALLOWED_ATTR:["class","id","href","style","src","alt"],...t},o=j.default.sanitize(e,r);if(n.innerHTML!==String(o))return n.innerHTML=String(o)};var B=f(require("dompurify"),1),v=null,O=(n,e)=>{if(typeof document>"u")return;let t=document.getElementById(n);if(!t)return;let r=t.innerHTML,o=B.default.sanitize(r);if(v!==null&&o!==v){let s=document.createElement("div");e(s),t.innerHTML=v}else v=o,e(t)};var z=n=>{let e=document.createElement("div");return e.innerText=n,e.innerHTML},k=(n,e,t,r="",o=null)=>{if(!n)return;let s=z(e),a=z(t),i=r?z(r):void 0;n.setAttribute("href",s),n.setAttribute("aria-label",a),i&&(n.className=i),o&&(n.innerHTML="",n.appendChild(o)),n.addEventListener("click",l=>{l.preventDefault();let m=l.currentTarget.getAttribute("href");if(m){let c=window.scrollY;window.scrollTo(0,0),window.history.pushState({scrollPosition:c},"",m);let g=new PopStateEvent("popstate");dispatchEvent(g)}}),window.addEventListener("popstate",l=>{let u=l.state;u&&u.scrollPosition!==void 0&&window.scrollTo(0,u.scrollPosition)})};var G=require("lodash-es"),M=n=>n;typeof window<"u"&&typeof document<"u"&&(M=n=>{let e=document.createElement("div");return e.innerText=n,e.innerHTML});var q=typeof window<"u"?(0,G.debounce)(n=>{n.forEach(e=>{if(!e)return;let t=e.getAttribute("href")||"#",r=e.getAttribute("class")||"",o=M(t),s=e.getAttribute("class")?M(e.getAttribute("class")):r;e.setAttribute("href",o),e.setAttribute("class",s),e.getAttribute("aria-label")&&e.setAttribute("aria-label",M(e.getAttribute("aria-label")));let a=e.querySelector(":scope > *");a&&(e.innerHTML="",e.appendChild(a)),e.addEventListener("click",i=>{let u=i.currentTarget.getAttribute("href");try{if(new URL(u,window.location.href).origin!==window.location.origin)return}catch(c){console.error("Invalid URL:",c);return}i.preventDefault(),window.history.pushState({},"",u);let m=new PopStateEvent("popstate");window.dispatchEvent(m)})})}):()=>{};var h=f(require("dompurify"),1);var W=(n="'self' 'nonce-rAnd0m123' 'unsafe-inline' 'unsafe-eval'",e="'self' 'nonce-rAnd0m123'",t="'none'",r="'self' https://fonts.googleapis.com https://fonts.gstatic.com",o="'self' https://blogger.googleusercontent.com",s=["'self'","https://fonts.googleapis.com","https://fonts.gstatic.com","https://www.google.com/maps/"],a="'self' https://www.youtube.com",i="'self'",l="/csp-report",u=!1)=>{let m=()=>{try{let c=document.querySelector('meta[http-equiv="Content-Security-Policy"]');c||(c=document.createElement("meta"),c.setAttribute("http-equiv","Content-Security-Policy"),document.head.appendChild(c));let g=u?`report-uri ${l};`:"";c.setAttribute("content",`default-src 'self'; script-src ${n}; style-src ${e}; object-src ${t}; font-src ${r}; img-src ${o}; connect-src ${s.join(" ")}; frame-src ${a}; base-uri ${i}; ${g}`)}catch(c){console.error("Error adding CSP meta element:",c)}};document.readyState==="loading"?document.addEventListener("DOMContentLoaded",m):m()};var $=(n,e)=>{let t={name:h.default.sanitize(n.name||""),description:h.default.sanitize(n.description||"Default description"),author:h.default.sanitize(n.author||"")},r=d=>{t.name=h.default.sanitize(d),c("name",t.name)},o=d=>{t.description=h.default.sanitize(d),c("description",t.description)},s=d=>{t.author=h.default.sanitize(d),c("author",t.author)},a=()=>t.name,i=()=>t.description,l=()=>t.author,u=()=>t,m=(d,E)=>{let S=document.createElement("meta");S.setAttribute("name",d),S.setAttribute("content",E),document.head.appendChild(S)},c=(d,E)=>{let S=document.querySelector(`meta[name="${d}"]`);S?S.setAttribute("content",E):m(d,E)},g=()=>{c("name",t.name),c("description",t.description),c("author",t.author)};return e&&W(e.scriptSrc,e.styleSrc,e.objectSrc,Array.isArray(e.connectSrc)?e.connectSrc.join(" "):e.connectSrc,e.reportOnly!==void 0?String(e.reportOnly):void 0),g(),{setName:r,setDescription:o,setAuthor:s,getName:a,getDescription:i,getAuthor:l,getAllMetaData:u,appendMetaTagsToHead:g}};var Y=f(require("dompurify"),1),L=(n,e,t,r,o)=>{Y.default.sanitize(e),t(e.querySelector(`#${n}`),r,o)};var N=n=>{let e=document.querySelector(n);return e||(console.warn(`[useTSSelect] No element found for selector: '${n}'`),null)};var J=require("jwt-decode"),I=(n,e)=>{let t=localStorage.getItem("token");if(!t)return window.location.href=e,null;try{let r=(0,J.jwtDecode)(t),o=Date.now()/1e3;return r.exp&&r.exp<o&&(console.error("Token has expired"),window.localStorage.removeItem("token"),window.location.href=e),null}catch(r){return console.error("Invalid token:",r),window.location.href=e,null}};var F=(n,e,t)=>{n.forEach(r=>{e.forEach(o=>{r.addEventListener(o,s=>{t(r,s)})})})};var U=f(require("dompurify"),1);var V=require("zustand/vanilla"),X=f(require("dompurify"),1),p=(0,V.createStore)(n=>({params:{},query:{},setParams:e=>n(()=>({params:K(e)})),setQuery:e=>n(()=>({query:K(e)}))}));function K(n){let e={};for(let t in n)e[t]=X.default.sanitize(n[t]);return e}var P=class{constructor(e,t){this.routes=[];this.routes=e,this.expectedParams=new Set(t),window.addEventListener("popstate",this.handlePopState.bind(this)),this.handlePopState()}handlePopState(){let e=window.location.pathname,t=window.location.search,r=this.parseQueryParams(t),o=this.findMatchingRoute(e,this.routes);if(o){if(o.routeto){this.navigate(o.routeto);return}let s=this.filterAndSanitizeParams(o.params);p.getState().setParams(s),p.getState().setQuery(r);let a=document.createElement("div");if(o.element?.(a,s,r),o.children){let i=e.slice(o.path.length),l=a.querySelector("#child");l&&this.renderChildren(o.children,i,l,s,r)}}else{let s=this.findMatchingRoute("*",this.routes);if(s){let a=this.filterAndSanitizeParams(s.params);p.getState().setParams(a),p.getState().setQuery(r);let i=document.createElement("div");s.element?.(i,a,r)}}}renderChildren(e,t,r,o,s){if(!e||e.length===0){let i=r.querySelector("#child");i&&i.remove();return}let a=this.findMatchingRoute(t,e);if(a){let i=document.createElement("div");i.id="child";let l={...o,...a.params},u=this.filterAndSanitizeParams(l);if(p.getState().setParams(u),p.getState().setQuery(s),a.element?.(i,u,s),r.appendChild(i),a.children){let m=t.slice(a.path.length);this.renderChildren(a.children,m,i,u,s)}}}parseQueryParams(e){let t={},r=new URLSearchParams(e);for(let[o,s]of r.entries())this.expectedParams.has(o)&&(t[o]=U.default.sanitize(s));return t}findMatchingRoute(e,t,r={}){for(let o of t){let s=o.path;if(s==="*")return o;{let i=[],l=s.replace(/:[^\s/]+/g,c=>(i.push(c.substring(1)),"([^\\s/]+)")),u=new RegExp(`^${l}(?:/|$)`),m=e.match(u);if(m){let c={...r};if(i.forEach((g,d)=>{c[g]=m[d+1]??""}),o.children){let g=e.slice(m[0].length),d=this.findMatchingRoute(g,o.children,c);if(d)return d}return{...o,params:c}}}}}filterAndSanitizeParams(e){if(!e)return{};let t={};for(let r in e)this.expectedParams.has(r)&&(t[r]=U.default.sanitize(e[r]??""));return t}navigate(e){history.pushState(null,"",e),this.handlePopState()}addRoute(e){this.routes.push(e)}};0&&(module.exports={TSRouter,html,useAnchor,useAnchorSingle,useInitialDOM,useTSAuth,useTSComponent,useTSElementEach,useTSElements,useTSEvent,useTSEventAll,useTSExtractParams,useTSMetaData,useTSParams,useTSPurifier,useTSSelect});
//# sourceMappingURL=index.cjs.map