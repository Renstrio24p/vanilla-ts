"use strict";var Y=Object.create;var S=Object.defineProperty;var J=Object.getOwnPropertyDescriptor;var K=Object.getOwnPropertyNames;var V=Object.getPrototypeOf,X=Object.prototype.hasOwnProperty;var Z=(t,e)=>{for(var n in e)S(t,n,{get:e[n],enumerable:!0})},N=(t,e,n,r)=>{if(e&&typeof e=="object"||typeof e=="function")for(let o of K(e))!X.call(t,o)&&o!==n&&S(t,o,{get:()=>e[o],enumerable:!(r=J(e,o))||r.enumerable});return t};var d=(t,e,n)=>(n=t!=null?Y(V(t)):{},N(e||!t||!t.__esModule?S(n,"default",{value:t,enumerable:!0}):n,t)),ee=t=>N(S({},"__esModule",{value:!0}),t);var oe={};Z(oe,{TSRouter:()=>v,html:()=>M,useAnchor:()=>O,useAnchorSingle:()=>D,useInitialDOM:()=>H,useTSAuth:()=>k,useTSComponent:()=>y,useTSElementEach:()=>q,useTSElements:()=>C,useTSEvent:()=>x,useTSEventAll:()=>w,useTSExtractParams:()=>A,useTSParams:()=>p,useTSPurifier:()=>P,useTSSelect:()=>z});module.exports=ee(oe);function M(t,...e){return t.reduce((n,r,o)=>n+r+(e[o]||""),"")}var L=d(require("dompurify"),1),P=(t,e)=>{let r={...{ADD_TAGS:["my-custom-tag"]},...e};return typeof t=="string"?L.default.sanitize(t,r):L.default.sanitize(t.innerHTML,r)};var x=(t,e,n)=>{let r=document.querySelector(`#${t}`);r?r.addEventListener(e,n):console.warn(`Element with id '${t}' not found.`)};var I=require("zustand/vanilla"),R=d(require("dompurify"),1);function te(t,e){let n=[],r=t.replace(/:[^/]+/g,i=>(n.push(i.slice(1)),"([^/]+)")),o=new RegExp(`^${r}$`),s=e.match(o),a={};return s&&n.forEach((i,c)=>{a[i]=R.default.sanitize(s[c+1]??"")}),a}function ne(t){let e={},n=new URLSearchParams(t);for(let[r,o]of n.entries())e[r]=R.default.sanitize(o);return e}var p=(0,I.createStore)((t,e)=>({params:{},query:{},setFromPattern:n=>{let r=window.location.pathname,o=te(n,r),s=ne(window.location.search);t({params:o,query:s})},getParam:n=>e().params[n],getQuery:n=>e().query[n]}));function A(t){let e=p.getState();e.setFromPattern(t);let n=e.params,r=e.query;return{...n,...r}}var w=(t,e,n)=>{let r=document.querySelectorAll(t);return r.forEach(o=>{o.addEventListener(e,n)}),()=>{r.forEach(o=>{o.removeEventListener(e,n)})}};var F=d(require("dompurify"),1),C=(t,e,n)=>{let r={ALLOWED_TAGS:["main","div","h1","p","button","span","a","img","input"],ALLOWED_ATTR:["class","id","href","style","src","alt"],...n},o=F.default.sanitize(e,r);if(t.innerHTML!==String(o))return t.innerHTML=String(o)};var U=d(require("dompurify"),1),T=null,H=(t,e)=>{if(typeof document>"u")return;let n=document.getElementById(t);if(!n)return;let r=n.innerHTML,o=U.default.sanitize(r);if(T!==null&&o!==T){let s=document.createElement("div");e(s),n.innerHTML=T}else T=o,e(n)};var b=t=>{let e=document.createElement("div");return e.innerText=t,e.innerHTML},D=(t,e,n,r="",o=null)=>{if(!t)return;let s=b(e),a=b(n),i=r?b(r):void 0;t.setAttribute("href",s),t.setAttribute("aria-label",a),i&&(t.className=i),o&&(t.innerHTML="",t.appendChild(o)),t.addEventListener("click",c=>{c.preventDefault();let u=c.currentTarget.getAttribute("href");if(u){let m=window.scrollY;window.scrollTo(0,0),window.history.pushState({scrollPosition:m},"",u);let f=new PopStateEvent("popstate");dispatchEvent(f)}}),window.addEventListener("popstate",c=>{let l=c.state;l&&l.scrollPosition!==void 0&&window.scrollTo(0,l.scrollPosition)})};var Q=d(require("lodash"),1),E=t=>t;typeof window<"u"&&typeof document<"u"&&(E=t=>{let e=document.createElement("div");return e.innerText=t,e.innerHTML});var O=typeof window<"u"?(0,Q.default)(t=>{t.forEach(e=>{if(!e)return;let n=e.getAttribute("href")||"#",r=e.getAttribute("class")||"",o=E(n),s=e.getAttribute("class")?E(e.getAttribute("class")):r;e.setAttribute("href",o),e.setAttribute("class",s),e.getAttribute("aria-label")&&e.setAttribute("aria-label",E(e.getAttribute("aria-label")));let a=e.querySelector(":scope > *");a&&(e.innerHTML="",e.appendChild(a)),e.addEventListener("click",i=>{let l=i.currentTarget.getAttribute("href");try{if(new URL(l,window.location.href).origin!==window.location.origin)return}catch(m){console.error("Invalid URL:",m);return}i.preventDefault(),window.history.pushState({},"",l);let u=new PopStateEvent("popstate");window.dispatchEvent(u)})})}):()=>{};var re=d(require("dompurify"),1);var _=d(require("dompurify"),1),y=(t,e,n,r,o)=>{_.default.sanitize(e),n(e.querySelector(`#${t}`),r,o)};var z=t=>{let e=document.querySelector(t);return e||(console.warn(`[useTSSelect] No element found for selector: '${t}'`),null)};var j=require("jwt-decode"),k=(t,e)=>{let n=localStorage.getItem("token");if(!n)return window.location.href=e,null;try{let r=(0,j.jwtDecode)(n),o=Date.now()/1e3;return r.exp&&r.exp<o&&(console.error("Token has expired"),window.localStorage.removeItem("token"),window.location.href=e),null}catch(r){return console.error("Invalid token:",r),window.location.href=e,null}};var q=(t,e,n)=>{t.forEach(r=>{e.forEach(o=>{r.addEventListener(o,s=>{n(r,s)})})})};var $=d(require("dompurify"),1);var G=require("zustand/vanilla"),W=d(require("dompurify"),1),g=(0,G.createStore)(t=>({params:{},query:{},setParams:e=>t(()=>({params:B(e)})),setQuery:e=>t(()=>({query:B(e)}))}));function B(t){let e={};for(let n in t)e[n]=W.default.sanitize(t[n]);return e}var v=class{constructor(e,n){this.routes=[];this.routes=e,this.expectedParams=new Set(n),window.addEventListener("popstate",this.handlePopState.bind(this)),this.handlePopState()}handlePopState(){let e=window.location.pathname,n=window.location.search,r=this.parseQueryParams(n),o=this.findMatchingRoute(e,this.routes);if(o){if(o.routeto){this.navigate(o.routeto);return}let s=this.filterAndSanitizeParams(o.params);g.getState().setParams(s),g.getState().setQuery(r);let a=document.createElement("div");if(o.element?.(a,s,r),o.children){let i=e.slice(o.path.length),c=a.querySelector("#child");c&&this.renderChildren(o.children,i,c,s,r)}}else{let s=this.findMatchingRoute("*",this.routes);if(s){let a=this.filterAndSanitizeParams(s.params);g.getState().setParams(a),g.getState().setQuery(r);let i=document.createElement("div");s.element?.(i,a,r)}}}renderChildren(e,n,r,o,s){if(!e||e.length===0){let i=r.querySelector("#child");i&&i.remove();return}let a=this.findMatchingRoute(n,e);if(a){let i=document.createElement("div");i.id="child";let c={...o,...a.params},l=this.filterAndSanitizeParams(c);if(g.getState().setParams(l),g.getState().setQuery(s),a.element?.(i,l,s),r.appendChild(i),a.children){let u=n.slice(a.path.length);this.renderChildren(a.children,u,i,l,s)}}}parseQueryParams(e){let n={},r=new URLSearchParams(e);for(let[o,s]of r.entries())this.expectedParams.has(o)&&(n[o]=$.default.sanitize(s));return n}findMatchingRoute(e,n,r={}){for(let o of n){let s=o.path;if(s==="*")return o;{let i=[],c=s.replace(/:[^\s/]+/g,m=>(i.push(m.substring(1)),"([^\\s/]+)")),l=new RegExp(`^${c}(?:/|$)`),u=e.match(l);if(u){let m={...r};if(i.forEach((f,h)=>{m[f]=u[h+1]??""}),o.children){let f=e.slice(u[0].length),h=this.findMatchingRoute(f,o.children,m);if(h)return h}return{...o,params:m}}}}}filterAndSanitizeParams(e){if(!e)return{};let n={};for(let r in e)this.expectedParams.has(r)&&(n[r]=$.default.sanitize(e[r]??""));return n}navigate(e){history.pushState(null,"",e),this.handlePopState()}addRoute(e){this.routes.push(e)}};0&&(module.exports={TSRouter,html,useAnchor,useAnchorSingle,useInitialDOM,useTSAuth,useTSComponent,useTSElementEach,useTSElements,useTSEvent,useTSEventAll,useTSExtractParams,useTSParams,useTSPurifier,useTSSelect});
//# sourceMappingURL=index.cjs.map