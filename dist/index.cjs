"use strict";var ne=Object.create;var y=Object.defineProperty;var re=Object.getOwnPropertyDescriptor;var oe=Object.getOwnPropertyNames;var se=Object.getPrototypeOf,ie=Object.prototype.hasOwnProperty;var ae=(n,e)=>{for(var t in e)y(n,t,{get:e[t],enumerable:!0})},W=(n,e,t,r)=>{if(e&&typeof e=="object"||typeof e=="function")for(let o of oe(e))!ie.call(n,o)&&o!==t&&y(n,o,{get:()=>e[o],enumerable:!(r=re(e,o))||r.enumerable});return n};var f=(n,e,t)=>(t=n!=null?ne(se(n)):{},W(e||!n||!n.__esModule?y(t,"default",{value:n,enumerable:!0}):t,n)),ce=n=>W(y({},"__esModule",{value:!0}),n);var me={};ae(me,{TSRouter:()=>P,html:()=>x,renderChildRoutes:()=>_,useAnchor:()=>k,useAnchorSingle:()=>$,useInitialDOM:()=>D,useTSAuth:()=>I,useTSComponent:()=>L,useTSElementEach:()=>F,useTSElements:()=>O,useTSEvent:()=>C,useTSEventAll:()=>b,useTSExtractParams:()=>H,useTSMetaData:()=>q,useTSNavigate:()=>U,useTSOutlet:()=>Q,useTSParams:()=>T,useTSPurifier:()=>w,useTSSelect:()=>N});module.exports=ce(me);function x(n,...e){return n.reduce((t,r,o)=>t+r+(e[o]||""),"")}var R=f(require("dompurify"),1),w=(n,e)=>{let r={...{ADD_TAGS:["my-custom-tag"]},...e};return typeof n=="string"?R.default.sanitize(n,r):R.default.sanitize(n.innerHTML,r)};var C=(n,e,t)=>{let r=document.querySelector(`#${n}`);r?r.addEventListener(e,t):console.warn(`Element with id '${n}' not found.`)};var B=require("zustand/vanilla"),A=f(require("dompurify"),1);function le(n,e){let t=[],r=n.replace(/:[^/]+/g,a=>(t.push(a.slice(1)),"([^/]+)")),o=new RegExp(`^${r}$`),s=e.match(o),i={};return s&&t.forEach((a,l)=>{i[a]=A.default.sanitize(s[l+1]??"")}),i}function ue(n){let e={},t=new URLSearchParams(n);for(let[r,o]of t.entries())e[r]=A.default.sanitize(o);return e}var T=(0,B.createStore)((n,e)=>({params:{},query:{},setFromPattern:t=>{let r=window.location.pathname,o=le(t,r),s=ue(window.location.search);n({params:o,query:s})},getParam:t=>e().params[t],getQuery:t=>e().query[t]}));function H(n){let e=T.getState();e.setFromPattern(n);let t=e.params,r=e.query;return{...t,...r}}var b=(n,e,t)=>{let r=document.querySelectorAll(n);return r.forEach(o=>{o.addEventListener(e,t)}),()=>{r.forEach(o=>{o.removeEventListener(e,t)})}};var G=f(require("dompurify"),1),O=(n,e,t)=>{let r={ALLOWED_TAGS:["main","div","h1","p","button","span","a","img","input"],ALLOWED_ATTR:["class","id","href","style","src","alt"],...t},o=G.default.sanitize(e,r);if(n.innerHTML!==String(o))return n.innerHTML=String(o)};var Y=f(require("dompurify"),1),v=null,D=(n,e)=>{if(typeof document>"u")return;let t=document.getElementById(n);if(!t)return;let r=t.innerHTML,o=Y.default.sanitize(r);if(v!==null&&o!==v){let s=document.createElement("div");e(s),t.innerHTML=v}else v=o,e(t)};var z=n=>{let e=document.createElement("div");return e.innerText=n,e.innerHTML},$=(n,e,t,r="",o=null)=>{if(!n)return;let s=z(e),i=z(t),a=r?z(r):void 0;n.setAttribute("href",s),n.setAttribute("aria-label",i),a&&(n.className=a),o&&(n.innerHTML="",n.appendChild(o)),n.addEventListener("click",l=>{l.preventDefault();let m=l.currentTarget.getAttribute("href");if(m){let c=window.scrollY;window.scrollTo(0,0),window.history.pushState({scrollPosition:c},"",m);let p=new PopStateEvent("popstate");dispatchEvent(p)}}),window.addEventListener("popstate",l=>{let u=l.state;u&&u.scrollPosition!==void 0&&window.scrollTo(0,u.scrollPosition)})};var J=require("lodash-es"),M=n=>n;typeof window<"u"&&typeof document<"u"&&(M=n=>{let e=document.createElement("div");return e.innerText=n,e.innerHTML});var k=typeof window<"u"?(0,J.debounce)(n=>{n.forEach(e=>{if(!e)return;let t=e.getAttribute("href")||"#",r=e.getAttribute("class")||"",o=M(t),s=e.getAttribute("class")?M(e.getAttribute("class")):r;e.setAttribute("href",o),e.setAttribute("class",s),e.getAttribute("aria-label")&&e.setAttribute("aria-label",M(e.getAttribute("aria-label")));let i=e.querySelector(":scope > *");i&&(e.innerHTML="",e.appendChild(i)),e.addEventListener("click",a=>{let u=a.currentTarget.getAttribute("href");try{if(new URL(u,window.location.href).origin!==window.location.origin)return}catch(c){console.error("Invalid URL:",c);return}a.preventDefault(),window.history.pushState({},"",u);let m=new PopStateEvent("popstate");window.dispatchEvent(m)})})}):()=>{};var h=f(require("dompurify"),1);var K=(n="'self' 'nonce-rAnd0m123' 'unsafe-inline' 'unsafe-eval'",e="'self' 'nonce-rAnd0m123'",t="'none'",r="'self' https://fonts.googleapis.com https://fonts.gstatic.com",o="'self' https://blogger.googleusercontent.com",s=["'self'","https://fonts.googleapis.com","https://fonts.gstatic.com","https://www.google.com/maps/"],i="'self' https://www.youtube.com",a="'self'",l="/csp-report",u=!1)=>{let m=()=>{try{let c=document.querySelector('meta[http-equiv="Content-Security-Policy"]');c||(c=document.createElement("meta"),c.setAttribute("http-equiv","Content-Security-Policy"),document.head.appendChild(c));let p=u?`report-uri ${l};`:"";c.setAttribute("content",`default-src 'self'; script-src ${n}; style-src ${e}; object-src ${t}; font-src ${r}; img-src ${o}; connect-src ${s.join(" ")}; frame-src ${i}; base-uri ${a}; ${p}`)}catch(c){console.error("Error adding CSP meta element:",c)}};document.readyState==="loading"?document.addEventListener("DOMContentLoaded",m):m()};var q=(n,e)=>{let t={name:h.default.sanitize(n.name||""),description:h.default.sanitize(n.description||"Default description"),author:h.default.sanitize(n.author||"")},r=d=>{t.name=h.default.sanitize(d),c("name",t.name)},o=d=>{t.description=h.default.sanitize(d),c("description",t.description)},s=d=>{t.author=h.default.sanitize(d),c("author",t.author)},i=()=>t.name,a=()=>t.description,l=()=>t.author,u=()=>t,m=(d,E)=>{let S=document.createElement("meta");S.setAttribute("name",d),S.setAttribute("content",E),document.head.appendChild(S)},c=(d,E)=>{let S=document.querySelector(`meta[name="${d}"]`);S?S.setAttribute("content",E):m(d,E)},p=()=>{c("name",t.name),c("description",t.description),c("author",t.author)};return e&&K(e.scriptSrc,e.styleSrc,e.objectSrc,Array.isArray(e.connectSrc)?e.connectSrc.join(" "):e.connectSrc,e.reportOnly!==void 0?String(e.reportOnly):void 0),p(),{setName:r,setDescription:o,setAuthor:s,getName:i,getDescription:a,getAuthor:l,getAllMetaData:u,appendMetaTagsToHead:p}};var V=f(require("dompurify"),1),L=(n,e,t,r,o)=>{V.default.sanitize(e),t(e.querySelector(`#${n}`),r,o)};var N=n=>{let e=document.querySelector(n);return e||(console.warn(`[useTSSelect] No element found for selector: '${n}'`),null)};var X=require("jwt-decode"),I=(n,e)=>{let t=localStorage.getItem("token");if(!t)return window.location.href=e,null;try{let r=(0,X.jwtDecode)(t),o=Date.now()/1e3;return r.exp&&r.exp<o&&(console.error("Token has expired"),window.localStorage.removeItem("token"),window.location.href=e),null}catch(r){return console.error("Invalid token:",r),window.location.href=e,null}};var F=(n,e,t)=>{n.forEach(r=>{e.forEach(o=>{r.addEventListener(o,s=>{t(r,s)})})})};var U=()=>({back:()=>window.history.back(),forward:()=>window.history.forward()});var Q=(n,e)=>{let t=document.querySelector(`#${n}`)||document.querySelector(`.${n}`);if(!t)return;let r=window.location.pathname.replace(/\/$/,"");for(let o of e){let s=o.path.replace(/\/$/,"");if(r===s||r.startsWith(`${s}/`)){o.component(t);break}}};function _(n,e){let t=window.location.pathname.replace(/\/$/,"");e.routes.forEach(r=>{r.children?.length&&r.children.forEach(o=>{let s=o.path.replace(/\/$/,"");if(t===s||t.startsWith(`${s}/`)){let i=n.querySelector(`#${o.outlet}`)||n.querySelector(`.${o.outlet}`);i instanceof HTMLElement&&o.element&&o.element(i)}})})}var j=f(require("dompurify"),1);var ee=require("zustand/vanilla"),te=f(require("dompurify"),1),g=(0,ee.createStore)(n=>({params:{},query:{},setParams:e=>n(()=>({params:Z(e)})),setQuery:e=>n(()=>({query:Z(e)}))}));function Z(n){let e={};for(let t in n)e[t]=te.default.sanitize(n[t]);return e}var P=class{constructor(e,t){this.routes=[];this.routes=e,this.expectedParams=new Set(t),window.addEventListener("popstate",this.handlePopState.bind(this)),this.handlePopState()}handlePopState(){let e=window.location.pathname,t=window.location.search,r=this.parseQueryParams(t),o=this.findMatchingRoute(e,this.routes);if(o){if(o.routeto){this.navigate(o.routeto);return}let s=this.filterAndSanitizeParams(o.params);g.getState().setParams(s),g.getState().setQuery(r);let i=document.createElement("div");if(o.element?.(i,s,r),o.children){let a=e.slice(o.path.length),l=i.querySelector("#child");l&&this.renderChildren(o.children,a,l,s,r)}}else{let s=this.findMatchingRoute("*",this.routes);if(s){let i=this.filterAndSanitizeParams(s.params);g.getState().setParams(i),g.getState().setQuery(r);let a=document.createElement("div");s.element?.(a,i,r)}}}renderChildren(e,t,r,o,s){if(!e||e.length===0){let a=r.querySelector("#child");a&&a.remove();return}let i=this.findMatchingRoute(t,e);if(i){let a=document.createElement("div");a.id="child";let l={...o,...i.params},u=this.filterAndSanitizeParams(l);if(g.getState().setParams(u),g.getState().setQuery(s),i.element?.(a,u,s),r.appendChild(a),i.children){let m=t.slice(i.path.length);this.renderChildren(i.children,m,a,u,s)}}}parseQueryParams(e){let t={},r=new URLSearchParams(e);for(let[o,s]of r.entries())this.expectedParams.has(o)&&(t[o]=j.default.sanitize(s));return t}findMatchingRoute(e,t,r={}){for(let o of t){let s=o.path;if(s==="*")return o;{let a=[],l=s.replace(/:[^\s/]+/g,c=>(a.push(c.substring(1)),"([^\\s/]+)")),u=new RegExp(`^${l}(?:/|$)`),m=e.match(u);if(m){let c={...r};if(a.forEach((p,d)=>{c[p]=m[d+1]??""}),o.children){let p=e.slice(m[0].length),d=this.findMatchingRoute(p,o.children,c);if(d)return d}return{...o,params:c}}}}}filterAndSanitizeParams(e){if(!e)return{};let t={};for(let r in e)this.expectedParams.has(r)&&(t[r]=j.default.sanitize(e[r]??""));return t}navigate(e){history.pushState(null,"",e),this.handlePopState()}addRoute(e){this.routes.push(e)}};0&&(module.exports={TSRouter,html,renderChildRoutes,useAnchor,useAnchorSingle,useInitialDOM,useTSAuth,useTSComponent,useTSElementEach,useTSElements,useTSEvent,useTSEventAll,useTSExtractParams,useTSMetaData,useTSNavigate,useTSOutlet,useTSParams,useTSPurifier,useTSSelect});
//# sourceMappingURL=index.cjs.map